-car = Car.new

.section
  .conversation
    .outgoing join
    .incoming Hello there! To join the car share, please reply with your name.
    .outgoing Francine
    .incoming Nice to meet you, Francine. Please wait while I check in.
    .incoming=render_response(Responses::Approve)

  .conversation
    .outgoing status
    .incoming=render_response(Responses::Status, car: car)
    .outgoing borrow
    .incoming I am yours! I am parked behind 100 Ridgeway Road. The lockbox combination is 8421.

  =image_tag "safe.svg"
  =image_tag "key.svg"

  .conversation
    .incoming What is my odometer reading?
    .outgoing 19105
    .incoming Thanks, I updated the records with an odometer reading of 19105.

  =image_tag "wheel.svg"
  =image_tag "gas.svg"

  .conversation
    .outgoing gas 25.50
    .incoming I deducted your gas cost of $25.50. Your balance is now $12.75. Please submit the receipt when you return the key.

  .conversation
    .outgoing return
    .incoming Thanks for the ride! Please return me to 100 Ridgeway Road. The lockbox combination is 8421.
    .incoming What is the odometer reading?
    .outgoing 19189
    .incoming Wow, we drove 84km! That brings your balance to $33.75.

  =image_tag "calendar.svg"

  .conversation
    .outgoing book tomorrow from 2pm to 10
    .incoming You want to book me tomorrow from 2pm to 10pm? Say “confirm”, “abandon”, or another “book from X to Y”.
    .outgoing confirm
    .incoming Great, see you then!

-if user_signed_in? && current_user.admin?
  %h2 Admin commands
  %h3 Who
  .conversation
    .outgoing who
    .incoming.pre=Responses::Who.new(sharers: Sharer.all + [Sharer.new(name: "Ex.", number: "#123", pending_payments: 5.5, balance: 3.25)]).body.gsub("\n", "&#x000A;").html_safe
  %h3 Approve
  -prospective_approvee = Sharer.new(name: "Francine", number: "#12345")
  .conversation
    .incoming=Responses::ApproveAdminRequest.new(sharer: prospective_approvee).body
    .outgoing approve #{prospective_approvee.number}
    .incoming=Responses::ApproveAdmin.new(approvee: prospective_approvee).body
  %h3 Reject
  -sharer_to_reject= Sharer.new(name: "Pascal", number: "#67890")
  .conversation
    .incoming=Responses::ApproveAdminRequest.new(sharer: sharer_to_reject).body
    .outgoing reject #{sharer_to_reject.number}
    .incoming=Responses::Reject.new(rejectee: sharer_to_reject).body
  %h3 Collect
  -sharer = prospective_approvee
  -sharer.balance = 9.75
  -amount = 7.50
  .conversation
    .incoming=Responses::PayAdminNotification.new(sharer: sharer, amount: amount).body
    .outgoing collect #{number_to_currency amount}
    .incoming=Responses::Collect.new(amount: amount, collectee: sharer).body

%h2 Credits

%p To be moved elsewhere.

%ul
  %li Safe designed by <a href="http://www.thenounproject.com/krivoydesigner">Sergey Krivoy</a> from the <a href="http://www.thenounproject.com">Noun Project</a>
  %li Key designed by <a href="http://www.thenounproject.com/Luis">Luis Prado</a> from the <a href="http://www.thenounproject.com">Noun Project</a>
  %li Steering Wheel designed by <a href="http://www.thenounproject.com/francescofraioli">Francesco Fraioli</a> from the <a href="http://www.thenounproject.com">Noun Project</a>
  %li Gas designed by <a href="http://www.thenounproject.com/jontesta">Jon Testa</a> from the <a href="http://www.thenounproject.com">Noun Project</a>
